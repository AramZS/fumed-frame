<!DOCTYPE html>
<html lang="en" class="logo-theme">
  <head>
    <!-- 
      This is an HTML comment
      You can write text in a comment and the content won't be visible in the page
    -->
    <script src="https://unpkg.com/scrollama"></script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="preload"
      href="https://cdn.glitch.global/f20aef1f-8ae4-469e-a569-dd7a95c2daac/GarnetCapitals-Regular.woff2?v=1725315130751"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link rel="icon" href="https://glitch.com/favicon.ico" />

    <!--
      This is the page head - it contains info the browser uses
      Like the title, which appears on the browser tab but not inside the page
      Further down you'll see the content that displays in the page
    -->
    <title>Hello World!</title>

    <!-- The website stylesheet -->
    
    <link rel="stylesheet" href="/imgs.css" />
    <link rel="stylesheet" href="/style.css" />

    <!-- The website JavaScript file -->
    <script src="/script.js" defer></script>
  </head>
  <body class="bg-main text-color-main">
    <!--
      The body includes the content you see in the page
      Each element is defined using tags, like this <div></div>
      The attributes like class="wrapper" let us style elements in the CSS
    -->
    <div class="wrapper">
      <div class="container" role="main">
        <button type="button" class="nav-expander-button">
          <span hidden>Search &amp; Section Navigation</span>
          <svg aria-hidden="true" class="css-1fe7a5q" viewBox="0 0 16 16">
            <rect x="1" y="3" fill="#f2e1c2" width="14" height="2"></rect>
            <rect x="1" y="7" fill="#f2e1c2" width="14" height="2"></rect>
            <rect x="1" y="11" fill="#f2e1c2" width="14" height="2"></rect>
          </svg>
        </button>
        <div>
          
        </div>
        <div class="tower-left-tip fore-main halftone-bg"></div>
        <div class="main-header">
          <header>
            <div class="header-image">
              <h1>
                FUMED
              </h1>
              <div class="smokestacks-container">
                <img class="smokestacks" src="https://cdn.glitch.global/f20aef1f-8ae4-469e-a569-dd7a95c2daac/Fumed_Podcast_Site_Smokestacks_Only.png?v=1735253744424" />
              </div>

              <nav>
                <h2 class="tagline">
                   In the shadow of Americaâ€™s chemical plants and oil refineries 
                </h2>
                  <ul>
                    <li>Listen</li>
                    <li>About</li>
                    <li>Credits</li>
                  </ul>
              </nav>
            </div>
          </header>
        </div>
        <div class="tower-right-tip fore-main halftone-bg">

        </div>

        <div class="tower-left fore-main halftone-bg">
          <div class="tower-left-inner tower-inner">
            
          </div>
        </div>
        <div class="main-content">
          <main>
            <div class="main-body">
              <br />
              <section id="intro">
                <div class="theme-selector">
                  Themes:
                  <button class="theme-selector-btn" data-theme="logo">
                    Logo
                  </button>
                  <button class="theme-selector-btn" data-theme="logo-inverted">
                    Logo Inverted
                  </button>
                  <button class="theme-selector-btn" data-theme="logo-bright">
                    Logo Bright
                  </button>
                  <button
                    class="theme-selector-btn"
                    data-theme="logo-bright-inverted"
                  >
                    Logo Bright Inverted
                  </button>
                </div>
                <h2>Using this project</h2>

                <p>This is a brief intro.</p>

                <h1 class="intro__hed">Sticky Overlay Example</h1>
                <p class="intro__dek">Start scrolling to see how it works.</p>
              </section>

              <section id="scrolly">
                <figure id="scrolly-figure">
                  <div>0</div>
                </figure>

                <article>
                  <div class="step" data-step="1">
                    <p>STEP 1</p>
                    <p>
                      Lorem Ipsum test text
                    </p>
                  </div>
                  <div class="step" data-step="2">
                    <p>STEP 2</p>
                  </div>
                  <div class="step" data-step="3">
                    <p>STEP 3</p>
                  </div>
                  <div class="step" data-step="4">
                    <p>STEP 4</p>
                  </div>
                </article>
              </section>
              
              <section id="outro">
                <iframe class="w-full aspect-video" style="width:100%;height:800px;margin-top:400px;" src="https://www.earthcam.com/js/video/embed.php?type=h583&amp;vid=6081.flv&amp;w=auto&amp;company=SanJacintoMonument&amp;timezone=America/Chicago&amp;metar=KEFD" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>

              </section>
              <!--  ðŸš§ TODO: ADD BUTTON HERE -->

              <!-- Once you've added the button from TODO.md, click it in the page -->
              <!-- Check out the function in script.js to see how it works -->
            </div>
          </main>
        </div>
        <div class="tower-right fore-main halftone-bg">
                  <div class="tower-right-inner tower-inner">
            
          </div>
        </div>

        <div class="footer-full fore-main">
          <!-- The footer holds our remix button â€” you can keep or delete it âœ‚ -->
          <footer class="footer">
            <div>Footer Text</div>

            <div class="links"></div>
          </footer>
        </div>
      </div>
    </div>
    <!-- runtime stuff -->
    <svg class="a-svg-filter">
      <filter id="wavy2">
        <feTurbulence
          x="5"
          y="0"
          baseFrequency="0.02"
          numOctaves="5"
          seed="1"
        />
        <feDisplacementMap in="SourceGraphic" scale="20" />
      </filter>
    </svg>
    
	<script src="https://unpkg.com/d3@5.9.1/dist/d3.min.js"></script>

	<script>
    
    var getStoryData = function(){
      const fetchData = new Promise((resolve, reject) => {

      fetch('https://publichealthwatch.org/wp-json/wp/v2/tags')
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok ' + response.statusText);
          }
          return response.json();
        })
        .then(data => {
          resolve(data);
        })
        .catch(error => {
          console.error('There has been a problem with your fetch operation:', error);
        });
      })
      return fetchData;
    }
    
    let storyData = getStoryData();
    storyData.then(result => console.log(result))
    
		// using d3 for convenience
		var main = d3.select("main");
		var scrolly = main.select("#scrolly");
		var figure = scrolly.select("figure");
		var article = scrolly.select("article");
		var step = article.selectAll(".step");
    var figureEl = document.querySelector("#scrolly-figure")
    var figureElInner = document.querySelector("#scrolly-figure div");
    
			var imgSet = [
        "https://cdn.glitch.global/f20aef1f-8ae4-469e-a569-dd7a95c2daac/Channelview_25.jpg?v=1725829007195",
        "https://cdn.glitch.global/f20aef1f-8ae4-469e-a569-dd7a95c2daac/Channelview_06.jpg?v=1725829004369",
        "https://cdn.glitch.global/f20aef1f-8ae4-469e-a569-dd7a95c2daac/Channelview_02.jpg?v=1725829002975",
        "https://cdn.glitch.global/f20aef1f-8ae4-469e-a569-dd7a95c2daac/Channelview_09.jpg?v=1725829001495",
        "https://cdn.glitch.global/f20aef1f-8ae4-469e-a569-dd7a95c2daac/Channelview_13.jpg?v=1725831584421"
      ];  
    
    imgSet.forEach((imgUrl) => {
      var linkEl = document.createElement('link');
      linkEl.rel = "preload";
      linkEl.as = "image";
      linkEl.href = imgUrl;
     document.head.append(linkEl) 
    })
    
figureElInner.innerHTML = `<img src="${imgSet[0]}" />`;    
    
		// initialize the scrollama
		var scroller = scrollama();

		// generic window resize listener event
		function handleResize() {
			// 1. update height of step elements
			var stepH = Math.floor(window.innerHeight * 0.75);
			step.style("height", stepH + "px");

			var figureHeight = window.innerHeight / 2;
			var figureMarginTop = (window.innerHeight - figureHeight) / 2;

			figure
				.style("height", figureHeight + "px")
				.style("top", figureMarginTop + "px");

			// 3. tell scrollama to update new element dimensions
			scroller.resize();
		}

		// scrollama event handlers
		function handleStepEnter(response) {

      console.log(response);
			var { element, direction, index } = response;

			// add color to current step only
			step.classed("is-active", function (d, i) {
				return i === response.index;
			});

			// update graphic based on step
      console.log('Scroll Handle: ', element, figure, figureElInner)
			figureElInner.innerHTML = `<img src="${imgSet[response.index+1]}" />`;
		}


		function init() {

			// 1. force a resize on load to ensure proper dimensions are sent to scrollama
			handleResize();

			// 2. setup the scroller passing options
			// 		this will also initialize trigger observations
			// 3. bind scrollama event handlers (this can be chained like below)
			scroller
				.setup({
					step: "#scrolly article .step",
					offset: 0.33,
					debug: false
				})
				.onStepEnter(handleStepEnter);
		}

		// kick things off
		init();
	</script>
  </body>
</html>
